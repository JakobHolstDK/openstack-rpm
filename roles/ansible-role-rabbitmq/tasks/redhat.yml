- name: redhat | add the rabbit repo key'
  rpm_key:
    state: present
    key: https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc

- name: redhat | add the erlang repo
  yum_repository:
    name: erlang
    description: Erlang repo
    baseurl: https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/gpg.E495BB49CC4BBE5B.key

- name: redhat | add the rabbit mq repo
  yum_repository:
    name: rabbitmq
    description: Rabbitmq repo
    baseurl: https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/gpg.9F4587F226208342.key

- name: redhat | Install rabbitmq on target servers
  ansible.builtin.package:
    name:  '{{ item  }}'
    state: present
  with_items:
    - "rabbitmq-server"

- name: redhat | enabling the RabbitMQ Management Console
  rabbitmq_plugin: names=rabbitmq_management state=enabled
  notify: restart rabbitmq-server

- name: redhat | ensuring that the RabbitMQ service is running
  service: name=rabbitmq-server state=started enabled=yes



